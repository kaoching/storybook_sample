"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.transformJsdom = void 0;

var _template = _interopRequireDefault(require("@babel/template"));

var _transformCsf = require("../csf/transformCsf");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

const filePrefixer = (0, _template.default)(`
  import { render, screen } from "@testing-library/react";
  import { composeStory } from "@storybook/testing-react";
`);
const testPrefixer = (0, _template.default)(`
    console.log({ id: %%id%%, title: %%title%%, name: %%name%%, storyExport: %%storyExport%% });
    async () => {
      const Composed = await composeStory(%%storyExport%%, exports.default);
      const { container } = render(<Composed />);
      if(Composed.play) {
        await Composed.play({ canvasElement: container });
      }
    }
  `, {
  plugins: ['jsx']
});

const transformJsdom = src => {
  // @ts-ignore
  const result = (0, _transformCsf.transformCsf)(src, {
    filePrefixer,
    testPrefixer,
    insertTestIfEmpty: true
  });
  return result;
};

exports.transformJsdom = transformJsdom;